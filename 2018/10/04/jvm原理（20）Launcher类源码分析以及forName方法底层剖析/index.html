<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"ceaser.wang","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":true},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="上一节我们通过【ClassLoader.getSystemClassLoader()】得到系统类加载器，那么本节看一下这个方法的doc以及一些细节，方便我们更好的理解：">
<meta name="keywords" content="launcher,forName">
<meta property="og:type" content="article">
<meta property="og:title" content="jvm原理（20）Launcher类源码分析以及forName方法底层剖析">
<meta property="og:url" content="https://ceaser.wang/2018/10/04/jvm原理（20）Launcher类源码分析以及forName方法底层剖析/index.html">
<meta property="og:site_name" content="南贺神社">
<meta property="og:description" content="上一节我们通过【ClassLoader.getSystemClassLoader()】得到系统类加载器，那么本节看一下这个方法的doc以及一些细节，方便我们更好的理解：">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://ceaser.wang/2018/10/04/jvm原理（20）Launcher类源码分析以及forName方法底层剖析/20180415145420761.png">
<meta property="og:updated_time" content="2021-05-30T04:23:30.401Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="jvm原理（20）Launcher类源码分析以及forName方法底层剖析">
<meta name="twitter:description" content="上一节我们通过【ClassLoader.getSystemClassLoader()】得到系统类加载器，那么本节看一下这个方法的doc以及一些细节，方便我们更好的理解：">
<meta name="twitter:image" content="https://ceaser.wang/2018/10/04/jvm原理（20）Launcher类源码分析以及forName方法底层剖析/20180415145420761.png">

<link rel="canonical" href="https://ceaser.wang/2018/10/04/jvm原理（20）Launcher类源码分析以及forName方法底层剖析/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>jvm原理（20）Launcher类源码分析以及forName方法底层剖析 | 南贺神社</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">南贺神社</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">你写程序有写诗一样的感觉吗?</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">205</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">24</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">211</span></a>

  </li>
        <li class="menu-item menu-item-0xcc">

    <a href="/0xcc/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>0XCC</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://ceaser.wang/2018/10/04/jvm原理（20）Launcher类源码分析以及forName方法底层剖析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/../0xcc/index/Uchiha.jpg">
      <meta itemprop="name" content="CeaserWang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="南贺神社">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          jvm原理（20）Launcher类源码分析以及forName方法底层剖析
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-10-04 16:17:22" itemprop="dateCreated datePublished" datetime="2018-10-04T16:17:22+00:00">2018-10-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-05-30 04:23:30" itemprop="dateModified" datetime="2021-05-30T04:23:30+00:00">2021-05-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/jvm/" itemprop="url" rel="index"><span itemprop="name">jvm</span></a>
                </span>
            </span>

          
            <span id="/2018/10/04/jvm原理（20）Launcher类源码分析以及forName方法底层剖析/" class="post-meta-item leancloud_visitors" data-flag-title="jvm原理（20）Launcher类源码分析以及forName方法底层剖析" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2018/10/04/jvm原理（20）Launcher类源码分析以及forName方法底层剖析/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/10/04/jvm原理（20）Launcher类源码分析以及forName方法底层剖析/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>上一节我们通过【ClassLoader.getSystemClassLoader()】得到系统类加载器，那么本节看一下这个方法的doc以及一些细节，方便我们更好的理解：<br><font color="#FF0000"></font></p>
<a id="more"></a>
<p>public static ClassLoader getSystemClassLoader()<br>Returns the system class loader for delegation. This is the default delegation parent for new ClassLoader instances, and is typically the class loader used to start the application.<br><br>返回用于代理的系统类加载器，对于一个类加载器实例来说这是默认的父级代理，也是最典型的用于启动应用的类加载器。<br><font color="#FF0000"><br>This method is first invoked early in the runtime’s startup sequence, at which point it creates the system class loader and sets it as the context class loader of the invoking Thread.<br></font><br>这个方法最早在运行时启动的就会被调用，在这个调用点上会去创建系统类加载器，并且将其设置在调用线程为【上下文加载器】。<br><font color="#FF0000"><br>The default system class loader is an implementation-dependent instance of this class.<br></font><br>默认的系统类加载器是一个与这个类实现相关的实例<br><font color="#FF0000"><br>If the system property “java.system.class.loader” is defined when this method is first invoked then the value of that property is taken to be the name of a class that will be returned as the system class loader. The class is loaded using the default system class loader and must define a public constructor that takes a single parameter of type ClassLoader which is used as the delegation parent. An instance is then created using this constructor with the default system class loader as the parameter. The resulting class loader is defined to be the system class loader.<br></font><br>如果系统属性【java.system.class.loader】被定义，那么这个属性的值对应的class会被默认的系统类加载器 加载，并且作为系统类加载器，这个被定义的加载器必须有一个单个参数的构造器，参数的类型是ClassLoader，用来代理父加载器，使用这个构造器传入默认的的系统类加载器会创建一个类加载器的实例，这个实例会成为系统类加载器。<br><font color="#FF0000"><br>If a security manager is present, and the invoker’s class loader is not null and the invoker’s class loader is not the same as or an ancestor of the system class loader, then this method invokes the security manager’s checkPermission method with a RuntimePermission(“getClassLoader”) permission to verify access to the system class loader. If not, a SecurityException will be thrown.<br></font><br>安全略过，主要是介绍一些安全接入的权限是否可以接入</p>
<p>伏笔：<br>1、【上下文加载器】<br>2、定义ClassLoader类型的构造器<br>方法体：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public static ClassLoader getSystemClassLoader() &#123;</span><br><span class="line">    initSystemClassLoader();//初始化系统类加载器</span><br><span class="line">    if (scl == null) &#123;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">    //下边的是安全相关的，不做介绍</span><br><span class="line">    SecurityManager sm = System.getSecurityManager();</span><br><span class="line">    if (sm != null) &#123;</span><br><span class="line">        checkClassLoaderPermission(scl, Reflection.getCallerClass());</span><br><span class="line">    &#125;</span><br><span class="line">    return scl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>进入到initSystemClassLoader():</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">PS:</span><br><span class="line">sclSet、scl 成员变量介绍：</span><br><span class="line">    // The class loader for the system</span><br><span class="line">    // @GuardedBy(&quot;ClassLoader.class&quot;)</span><br><span class="line">    系统类加载器在ClassLoader的引用</span><br><span class="line">    private static ClassLoader scl;</span><br><span class="line"></span><br><span class="line">    // Set to true once the system class loader has been set</span><br><span class="line">    // @GuardedBy(&quot;ClassLoader.class&quot;)</span><br><span class="line">    //如果系统类加载器被加载过，即scl成员变量不是null，那么sclSet的值为true</span><br><span class="line">    private static boolean sclSet;</span><br><span class="line"></span><br><span class="line">    private static synchronized void initSystemClassLoader() &#123;</span><br><span class="line">        //系统类加载器是否被设置</span><br><span class="line">        if (!sclSet) &#123;</span><br><span class="line">             //双重判断，即sclSet是true，但是系统类加载器是null，排除非法异常</span><br><span class="line">            if (scl != null)</span><br><span class="line">                throw new IllegalStateException(&quot;recursive invocation&quot;);</span><br><span class="line">                //通过sun.misc.Launcher获取系统类加载器。sun.misc.Launcher是系统类加载器，扩展类加载器上层的一个概念，并且Oracle不是开源的</span><br><span class="line">            sun.misc.Launcher l = sun.misc.Launcher.getLauncher();</span><br><span class="line">            if (l != null) &#123;</span><br><span class="line">                Throwable oops = null;</span><br><span class="line">                scl = l.getClassLoader();</span><br><span class="line">                try &#123;</span><br><span class="line">                    scl = AccessController.doPrivileged(</span><br><span class="line">                        new SystemClassLoaderAction(scl));</span><br><span class="line">                &#125; catch (PrivilegedActionException pae) &#123;</span><br><span class="line">                    oops = pae.getCause();</span><br><span class="line">                    if (oops instanceof InvocationTargetException) &#123;</span><br><span class="line">                        oops = oops.getCause();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                if (oops != null) &#123;</span><br><span class="line">                    if (oops instanceof Error) &#123;</span><br><span class="line">                        throw (Error) oops;</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        // wrap the exception</span><br><span class="line">                        throw new Error(oops);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            sclSet = true;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>我们在idea里边看到的sun.misc.Launcher.getLauncher()的实现是反编译工具给出的，oracle并没有给出源码，但是我们可以去<a href="http://openjdk.java.net/" target="_blank" rel="noopener">openjdk</a>获取他的源码，也可以使用<a href="http://grepcode.com/search查看源码：" target="_blank" rel="noopener">http://grepcode.com/search查看源码：</a><br><a href="http://grepcode.com/search/?query=sun.misc.launcher" target="_blank" rel="noopener">http://grepcode.com/search/?query=sun.misc.launcher</a><br><a href="http://grepcode.com/file/repository.grepcode.com/java/root/jdk/openjdk/8u40-b25/sun/misc/Launcher.java#Launcher" target="_blank" rel="noopener">http://grepcode.com/file/repository.grepcode.com/java/root/jdk/openjdk/8u40-b25/sun/misc/Launcher.java#Launcher</a><br>sun.misc.Launcher.getLauncher()z返回值是sun.misc.Launcher内部的一个静态成员变量【 private static Launcher launcher = new Launcher();】<br>那么我们看一下Launcher的构造器：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">public Launcher() &#123;</span><br><span class="line">68         // Create the extension class loader</span><br><span class="line">			//获得系统类加载器</span><br><span class="line">69         ClassLoader extcl;</span><br><span class="line">70         try &#123;</span><br><span class="line">				//ExtClassLoader是Launcher的一个内部类，getExtClassLoader()getExtClassLoader()获取扩展类加载器，</span><br><span class="line">				/**</span><br><span class="line">					getExtClassLoader()方法里边返回扩展类加载器实例，并且通过系统属性java.ext.dirs加载其需要加载的类</span><br><span class="line">				*/</span><br><span class="line">71             extcl = ExtClassLoader.getExtClassLoader();</span><br><span class="line">72         &#125; catch (IOException e) &#123;</span><br><span class="line">73             throw new InternalError(</span><br><span class="line">74                 &quot;Could not create extension class loader&quot;, e);</span><br><span class="line">75         &#125;</span><br><span class="line">76</span><br><span class="line">77         // Now create the class loader to use to launch the application</span><br><span class="line">			//获取系统类加载器，并且将扩展类加载器作为他的委托传入</span><br><span class="line">78         try &#123;</span><br><span class="line">79             loader = AppClassLoader.getAppClassLoader(extcl);</span><br><span class="line">80         &#125; catch (IOException e) &#123;</span><br><span class="line">81             throw new InternalError(</span><br><span class="line">82                 &quot;Could not create application class loader&quot;, e);</span><br><span class="line">83         &#125;</span><br><span class="line">84</span><br><span class="line">85         // Also set the context class loader for the primordial thread.</span><br><span class="line">			//将系统类加载器作为当前线程上下文的加载器</span><br><span class="line">86         Thread.currentThread().setContextClassLoader(loader);</span><br><span class="line">87</span><br><span class="line">88         // Finally, install a security manager if requested</span><br><span class="line">89         String s = System.getProperty(&quot;java.security.manager&quot;);</span><br><span class="line">90         if (s != null) &#123;</span><br><span class="line">91             SecurityManager sm = null;</span><br><span class="line">92             if (&quot;&quot;.equals(s) || &quot;default&quot;.equals(s)) &#123;</span><br><span class="line">93                 sm = new java.lang.SecurityManager();</span><br><span class="line">94             &#125; else &#123;</span><br><span class="line">95                 try &#123;</span><br><span class="line">96                     sm = (SecurityManager)loader.loadClass(s).newInstance();</span><br><span class="line">97                 &#125; catch (IllegalAccessException e) &#123;</span><br><span class="line">98                 &#125; catch (InstantiationException e) &#123;</span><br><span class="line">99                 &#125; catch (ClassNotFoundException e) &#123;</span><br><span class="line">100                &#125; catch (ClassCastException e) &#123;</span><br><span class="line">101                &#125;</span><br><span class="line">102            &#125;</span><br><span class="line">103            if (sm != null) &#123;</span><br><span class="line">104                System.setSecurityManager(sm);</span><br><span class="line">105            &#125; else &#123;</span><br><span class="line">106                throw new InternalError(</span><br><span class="line">107                    &quot;Could not create SecurityManager: &quot; + s);</span><br><span class="line">108            &#125;</span><br><span class="line">109        &#125;</span><br><span class="line">110    &#125;</span><br></pre></td></tr></table></figure>

<p>扩展类加载器获取加载文件数组：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">169        private static File[]  getExtDirs() &#123;</span><br><span class="line">				//加载来源来自于系统属性java.ext.dirs</span><br><span class="line">170            String s = System.getProperty(&quot;java.ext.dirs&quot;);</span><br><span class="line">171            File[] dirs;</span><br><span class="line">172            if (s != null) &#123;</span><br><span class="line">173                StringTokenizer st =</span><br><span class="line">174                    new StringTokenizer(s, File.pathSeparator);</span><br><span class="line">175                int count = st.countTokens();</span><br><span class="line">176                dirs = new File[count];</span><br><span class="line">177                for (int i = 0; i &lt; count; i++) &#123;</span><br><span class="line">178                    dirs[i] = new File(st.nextToken());</span><br><span class="line">179                &#125;</span><br><span class="line">180            &#125; else &#123;</span><br><span class="line">181                dirs = new File[0];</span><br><span class="line">182            &#125;</span><br><span class="line">183            return dirs;</span><br><span class="line">184        &#125;</span><br></pre></td></tr></table></figure>

<p>getAppClassLoader的方法：<br>入参是扩展类加载器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">267        public static ClassLoader getAppClassLoader(final ClassLoader extcl)</span><br><span class="line">268            throws IOException</span><br><span class="line">269        &#123;</span><br><span class="line">				//通过系统属性java.class.path获取加载路径</span><br><span class="line">270            final String s = System.getProperty(&quot;java.class.path&quot;);</span><br><span class="line">271            final File[] path = (s == null) ? new File[0] : getClassPath(s);</span><br><span class="line">272</span><br><span class="line">273            // Note: on bugid 4256530</span><br><span class="line">274            // Prior implementations of this doPrivileged() block supplied</span><br><span class="line">275            // a rather restrictive ACC via a call to the private method</span><br><span class="line">276            // AppClassLoader.getContext(). This proved overly restrictive</span><br><span class="line">277            // when loading  classes. Specifically it prevent</span><br><span class="line">278            // accessClassInPackage.sun.* grants from being honored.</span><br><span class="line">279            //</span><br><span class="line">280            return AccessController.doPrivileged(</span><br><span class="line">281                new PrivilegedAction&lt;AppClassLoader&gt;() &#123;</span><br><span class="line">282                    public AppClassLoader More ...run() &#123;</span><br><span class="line">283                    URL[] urls =</span><br><span class="line">284                        (s == null) ? new URL[0] : pathToURLs(path);</span><br><span class="line">						//构造系统类加载器的时候将他的委托父类传入，以及加载路径数组</span><br><span class="line">285                    return new AppClassLoader(urls, extcl);</span><br><span class="line">286                &#125;</span><br><span class="line">287            &#125;);</span><br><span class="line">288        &#125;</span><br><span class="line">289</span><br><span class="line">290        final URLClassPath ucp;</span><br><span class="line">291</span><br><span class="line">292        /*</span><br><span class="line">293         * Creates a new AppClassLoader</span><br><span class="line">294         */</span><br><span class="line">295        AppClassLoader(URL[] urls, ClassLoader parent) &#123;</span><br><span class="line">				//调用父类URLClassLoader,注意不管是系统类加载器还是扩展类加载器都是继承来自ClassLoader</span><br><span class="line">				//CLassLoader里边之前说过有一个硬编码的成员变量【private final ClassLoader parent;】</span><br><span class="line">				//此处的parent一直溯源到ClassLoader 类，将ClassLoader 的parent赋值为当前方法传入的parent入参，</span><br><span class="line">				//也就说明了系统类加载器的委托父类就是扩展类加载器</span><br><span class="line">296            super(urls, parent, factory);</span><br><span class="line">297            ucp = SharedSecrets.getJavaNetAccess().getURLClassPath(this);</span><br><span class="line">298            ucp.initLookupCache(this);</span><br><span class="line">299        &#125;</span><br></pre></td></tr></table></figure>

<p>然后我们再回过头来看看idea里边反编译出来的获取系统类加载器的方法：<br><img src="20180415145420761.png" alt="这里写图片描述"><br>大家可能会有疑问，为什么反编译出来的变量都是var1、var2之类的呢？其实这个在龙哥的<a href="http://www.iprogramming.cn/kotlin_lesson.html" target="_blank" rel="noopener">kotlin</a>课程中【27_Kotlin函数使用综述与显式返回类型分析】一讲里边介绍过，Java中并不总是在class 字节码中携带变量名，但是在kotlin里边就不是这样的，因为kotlin里边有具名参数的概念。</p>
<p>ok，我们回到initSystemClassLoader()方法,通过调用【 sun.misc.Launcher l = sun.misc.Launcher.getLauncher();】获取到系统类加载器之后，赋值给ClassLoader的scl成员变量之后，还有一块代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">try &#123;</span><br><span class="line">    scl = AccessController.doPrivileged(</span><br><span class="line">        new SystemClassLoaderAction(scl));</span><br><span class="line">&#125; catch (PrivilegedActionException pae) &#123;</span><br><span class="line">    oops = pae.getCause();</span><br><span class="line">    if (oops instanceof InvocationTargetException) &#123;</span><br><span class="line">        oops = oops.getCause();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这块逻辑的作用是看看是否设置了系统属性【java.system.class.loader】，即自定义的系统类加载器，如果设置了那么实例化自定义的系统类加载器返回，替代之前获取的系统类加载器，如果没有设置直接返回默认的系统类加载器。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">class SystemClassLoaderAction</span><br><span class="line">    implements PrivilegedExceptionAction&lt;ClassLoader&gt; &#123;</span><br><span class="line">    private ClassLoader parent;</span><br><span class="line"></span><br><span class="line">    SystemClassLoaderAction(ClassLoader parent) &#123;</span><br><span class="line">        this.parent = parent;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public ClassLoader run() throws Exception &#123;</span><br><span class="line">        String cls = System.getProperty(&quot;java.system.class.loader&quot;);</span><br><span class="line">        //自定义系统类加载器未定义，直接返回之前默认获取的系统类加载器</span><br><span class="line">        if (cls == null) &#123;</span><br><span class="line">            return parent;</span><br><span class="line">        &#125;</span><br><span class="line">		//如果定义了自定义的系统类加载器那么实例化并返回，替代默认的系统类加载器</span><br><span class="line">		//etDeclaredConstructor(new Class&lt;?&gt;[] &#123; ClassLoader.class &#125;)这个就是我们之前</span><br><span class="line">		//（https://blog.csdn.net/wzq6578702/article/details/79835695）</span><br><span class="line">		//在MyTest16里边加入一个参数是ClassLoader的构造器的原因，</span><br><span class="line">		//因为自定义的的加载器在这里会被反射调用，</span><br><span class="line">		//</span><br><span class="line">        Constructor&lt;?&gt; ctor = Class.forName(cls, true, parent)</span><br><span class="line">            .getDeclaredConstructor(new Class&lt;?&gt;[] &#123; ClassLoader.class &#125;);</span><br><span class="line">        ClassLoader sys = (ClassLoader) ctor.newInstance(</span><br><span class="line">            new Object[] &#123; parent &#125;);</span><br><span class="line">            //同样的道理 将自定义系统类加载器作为当前线程的上下文加载器。</span><br><span class="line">        Thread.currentThread().setContextClassLoader(sys);</span><br><span class="line">        return sys;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那么接下来介绍一下 Class.forName(cls, true, parent)，Class.forName方法大部分做web开发的都是在开始写jdbc的时候接触，那么先看一下doc：<br>java.lang.Class<br>public static Class&lt;?&gt; forName(@NonNls String name,<br>                               boolean initialize,<br>                               ClassLoader loader)<br>                       throws ClassNotFoundException<br>接收三个参数。<br>第一参数是要被加载的类的全名，第二个参数是用来表示是否初始化这个要被加载的类，第三个参数是类加载器。<br><font color="#FF0000"><br>Returns the Class object associated with the class or interface with the given string name, using the given class loader. Given the fully qualified name for a class or interface (in the same format returned by getName) this method attempts to locate, load, and link the class or interface. The specified class loader is used to load the class or interface. If the parameter loader is null, the class is loaded through the bootstrap class loader. The class is initialized only if the initialize parameter is true and if it has not been initialized earlier.<br></font><br>通过给定的类加载器，即入参loader，返回入参name对应的类或接口的Class对象，通过给定的接口或者类的全名(通过getName方法获取)尝试去定位，加载，连接，给定的loader用来加载类或者接口，如果参数loader是null，那么就会使用启动类加载器去加载，，只在在入参initialize 为true并且类从来没有被加载的情况下才去初始化这个类。<br><font color="#FF0000"><br>If name denotes a primitive type or void, an attempt will be made to locate a user-defined class in the unnamed package whose name is name. Therefore, this method cannot be used to obtain any of the Class objects representing primitive types or void.<br></font><br>如果name是原生类型或者是void，那么就会尝试在用户定义类的没有包名的包（default package）下边去定位，因为这个方法不能用于包含原生类型或者void类型<br><font color="#FF0000"><br>If name denotes an array class, the component type of the array class is loaded but not initialized.<br></font><br>如果name对应的是一个数组类型，这个数组的组件类型会被加载但是不会初始化。<br><font color="#FF0000"><br>For example, in an instance method the expression:<br>Class.forName(“Foo”)<br>is equivalent to:<br>Class.forName(“Foo”, true, this.getClass().getClassLoader())<br>Note that this method throws errors related to loading, linking or initializing as specified in Sections 12.2, 12.3 and 12.4 of The Java Language Specification. Note that this method does not check whether the requested class is accessible to its caller.<br></font><br>这个方法会抛出Java语言规范的12.2，12.3，12.4章节里边的相关的对于加载，连接，初始化相关的异常，注意这个方法并不会检查对于调用者来说是否访问。<br><font color="#FF0000"><br>If the loader is null, and a securiy manager is present, and the caller’s class loader is not null, then this method calls the security manager’s checkPermission method with a RuntimePermissin(“getClassLoader”) permission to ensure it’s ok to access the bootstrap class loader.<br></font><br>如果laoder是null，并且安全管理器指定了，并且调用者的加载器不是null，那么这个方法会调用安全管理器的checkPermission 方法，使用RuntimePermissin(“getClassLoader”) 来确定是否可以接入启动类加载器【这块了解即可】<br>代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">   public static Class&lt;?&gt; forName(String name, boolean initialize,</span><br><span class="line">                                  ClassLoader loader)</span><br><span class="line">       throws ClassNotFoundException</span><br><span class="line">   &#123;</span><br><span class="line">       Class&lt;?&gt; caller = null;</span><br><span class="line">       SecurityManager sm = System.getSecurityManager();</span><br><span class="line">       if (sm != null) &#123;</span><br><span class="line">           // Reflective call to get caller class is only needed if a security manager</span><br><span class="line">           // is present.  Avoid the overhead of making this call otherwise.</span><br><span class="line">           //获取调用此forName方法的类的Class对象A</span><br><span class="line">           caller = Reflection.getCallerClass();</span><br><span class="line">           if (sun.misc.VM.isSystemDomainLoader(loader)) &#123;</span><br><span class="line">            //获取A的类加载器</span><br><span class="line">               ClassLoader ccl = ClassLoader.getClassLoader(caller);</span><br><span class="line">               //安全检查</span><br><span class="line">               if (!sun.misc.VM.isSystemDomainLoader(ccl)) &#123;</span><br><span class="line">                   sm.checkPermission(</span><br><span class="line">                       SecurityConstants.GET_CLASSLOADER_PERMISSION);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       //name：要被加载的|initialize：是否初始化|loader：指定的类加载器（自定义加载器此处是系统类加载器）|caller调用者的Class对象</span><br><span class="line">       return forName0(name, initialize, loader, caller);</span><br><span class="line">   &#125;</span><br><span class="line">//forName0是一个本地方法</span><br><span class="line">   /** Called after security check for system loader access checks have been made. */</span><br><span class="line">   private static native Class&lt;?&gt; forName0(String name, boolean initialize,</span><br><span class="line">                                           ClassLoader loader,</span><br><span class="line">                                           Class&lt;?&gt; caller)</span><br><span class="line">       throws ClassNotFoundException;</span><br></pre></td></tr></table></figure>

<p>另外和只有一个参数的forName的区别：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public static Class&lt;?&gt; forName(String className)</span><br><span class="line">             throws ClassNotFoundException &#123;</span><br><span class="line">     Class&lt;?&gt; caller = Reflection.getCallerClass();</span><br><span class="line">     // className：要加载的Class名字 | 是否初始化：此处需要初始化 |调用者的类加载器 | 调用者的Class对象</span><br><span class="line">     return forName0(className, true, ClassLoader.getClassLoader(caller), caller);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>


    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:  </strong>CeaserWang
  </li>
  <li class="post-copyright-link">
    <strong>Post link: </strong>
    <a href="https://ceaser.wang/2018/10/04/jvm原理（20）Launcher类源码分析以及forName方法底层剖析/" title="jvm原理（20）Launcher类源码分析以及forName方法底层剖析">https://ceaser.wang/2018/10/04/jvm原理（20）Launcher类源码分析以及forName方法底层剖析/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/launcher/" rel="tag"><i class="fa fa-tag"></i> launcher</a>
              <a href="/tags/forName/" rel="tag"><i class="fa fa-tag"></i> forName</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2018/10/04/jvm原理（19）平台特定的启动类加载器深入分析与自定义系统类加载器详解/" rel="prev" title="jvm原理（19）平台特定的启动类加载器深入分析与自定义系统类加载器详解">
      <i class="fa fa-chevron-left"></i> jvm原理（19）平台特定的启动类加载器深入分析与自定义系统类加载器详解
    </a></div>
      <div class="post-nav-item">
    <a href="/2018/10/04/jvm原理（21）线程上下文类加载器分析与实现/" rel="next" title="jvm原理（21）线程上下文类加载器分析与实现">
      jvm原理（21）线程上下文类加载器分析与实现 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="CeaserWang"
      src="/../0xcc/index/Uchiha.jpg">
  <p class="site-author-name" itemprop="name">CeaserWang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">211</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">205</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/1156721874" title="GitHub → https://github.com/1156721874" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:ceaserwang@outlook.com" title="E-Mail → mailto:ceaserwang@outlook.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://twodragonlake.com" title="https://twodragonlake.com" rel="noopener" target="_blank">TwoDragonLake</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://rootcluster.github.io" title="https://rootcluster.github.io" rel="noopener" target="_blank">RootCluster</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://museflow.io" title="https://museflow.io" rel="noopener" target="_blank">MuseFlow</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://incoder.org" title="https://incoder.org" rel="noopener" target="_blank">BladeCode</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://kaifa.dev" title="https://kaifa.dev" rel="noopener" target="_blank">Alyenc</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://blog.dazhidayong.cn" title="https://blog.dazhidayong.cn" rel="noopener" target="_blank">Killua</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://jocelynshang.cn/" title="https://jocelynshang.cn/" rel="noopener" target="_blank">Jocelyn</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2015 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">CeaserWang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>



  




  <script src="/js/local-search.js"></script>












  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'ryAR9bttS7fex1FPEPAylmmJ-gzGzoHsz',
      appKey     : 'dYqygoN4Y01Bl38OdRoCHUYn',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
